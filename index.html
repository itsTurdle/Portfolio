<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Pre-cache thumbnails via fetch-thumbnails.js -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Hey, I'm turdleðŸ‘‹">
  <meta property="og:description" content="A 12,000 hour scripter.">
  <meta property="og:url" content="https://itsTurdle.github.io/hire/">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>t u r d l e</title>
  <link rel="icon" href="favicon.ico">
  <style>
    /* Core styles omitted for brevity; assume same as before */
  </style>
</head>
<body>
  <canvas id="bg-canvas"></canvas>
  <header>
    <h1>I'm turdle, a Scripter</h1>
    <!-- Skills list... -->
  </header>
  <div class="grid" id="grid"></div>
  <section class="contact">
    <a href="discord://-/users/862057084103163924" class="btn">
      <img src="discord.png" alt="Discord">Discord
    </a>
    <button class="btn" id="copyBtn">
      <img src="link.png" alt="Copy"><span id="copyLabel">its_turdle</span>
    </button>
  </section>
  <script>
    // Helper: AllOrigins proxy
    const proxy = url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}&cb=${Date.now()}`;

    // Fetch Roblox thumbnail metadata
    async function fetchThumbnailUrl(id) {
      const api = `https://thumbnails.roblox.com/v1/assets?assetIds=${id}&size=768x432&format=Png&isCircular=false`;
      const url = proxy(api);
      console.log('Fetching metadata via', url);
      try {
        const res = await fetch(url);
        const json = await res.json();
        return json.data?.[0]?.imageUrl || null;
      } catch (e) {
        console.error('Thumbnail metadata fetch failed', e);
        return null;
      }
    }

    const sleep = ms => new Promise(r => setTimeout(r, ms));

    // Canvas background animation (unchanged)
    // ...

    // Fetch and render games sequentially
    async function initGames() {
      const grid = document.getElementById('grid');
      const gamesRes = await fetch(proxy('https://games.roblox.com/v2/users/1914390459/games?accessFilter=Public&limit=10'));
      const games = (await gamesRes.json()).data.slice(0, 4);

      for (const game of games) {
        const card = document.createElement('div'); card.className = 'card';
        const inner = document.createElement('div'); inner.className = 'inner';
        const img = document.createElement('img');
        card.style.display = 'none';
        grid.append(card);

        // Attempt local
        const localUrl = `thumbnails/${game.rootPlace.id}.png`;
        img.src = localUrl;
        img.onload = () => {
          img.style.opacity = '1'; card.style.display = '';
        };
        img.onerror = async () => {
          await sleep(1000);
          const remote = await fetchThumbnailUrl(game.rootPlace.id);
          if (remote) {
            const proxied = proxy(remote);
            img.src = proxied;
            img.onload = () => { img.style.opacity = '1'; card.style.display = ''; };
            img.onerror = () => {
              img.src = 'https://via.placeholder.com/768x432?text=No+Image';
              img.onload = () => { card.style.display = ''; };
            };
          } else {
            img.src = 'https://via.placeholder.com/768x432?text=No+Image';
            img.onload = () => { card.style.display = ''; };
          }
        };
        inner.append(img);

        const info = document.createElement('div'); info.className = 'info';
        const created = new Date(game.created);
        const ageDays = Math.floor((Date.now() - created.getTime()) / 86400000);
        info.innerHTML = `
          <h3><a href="https://www.roblox.com/games/${game.rootPlace.id}" target="_blank">${game.name}</a></h3>
          <p>${(game.description || 'No description').slice(0, 90)}</p>
          <div class="age">ðŸ•’ ${ageDays}d ago</div>
          <a class="btn" href="roblox://placeId=${game.rootPlace.id}">Play</a>
        `;
        inner.append(info);
        card.append(inner);

        // Wait for image load
        await new Promise(r => img.onload || img.onerror ? r() : img.addEventListener('load', r));
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      initGames();
      document.getElementById('copyBtn').addEventListener('click', async () => {
        const t = document.getElementById('copyLabel').textContent;
        await navigator.clipboard.writeText(t);
        document.getElementById('copyLabel').textContent = 'Copied!';
        setTimeout(() => document.getElementById('copyLabel').textContent = 'its_turdle', 1500);
      });
    });
  </script>
</body>
</html>
